<!DOCTYPE html>
<html lang="en">
<%- include('../head.ejs',{page_name:'Forex'}) %>
<body>
  <%- include('../hotStyles.ejs') %>
  <!-- Loader -->
  <div id="loading">
    <img id="loading-image" src="/img/Gordon.gif" alt="Loading..." />
  </div>
  <!-- HEADER BEGIN -->
  <%- include('../menus/headerMenu.ejs',{user}) %>
  <!-- HEADER END -->
  <div class="d-flex align-items-stretch">
    <nav id="sidebar">
      <%- include('../menus/menu.ejs',{device:'pc'}) %>
    </nav>
    <div class="page-content" style="padding-bottom:70px;">
      <div class="page-header">
        <div class="container-fluid">
          <h2 class="h5 no-margin-bottom">Dữ liệu kinh tế Hoa Kỳ</h2>
        </div>
      </div>

      <section>
        <div class="container-fluid">
          <p class="text-danger">Giao diện mẫu đang phát triển, các thông tin chỉ mang tính minh họa</p>

            <!-- Policy target block begin -->
            <div class="row">
              <div class="col-lg-6 col-12 mx-auto">
                <div class="block">
                  <div class="row-title">
                    Policy target
                  </div>
                  <div class="container-fluid">
                    <div class="row">
                      <div class="col-12">
                        <div class="btn btn-success" id="us-gdp" style="width:100%" onclick="openIndicator('us-gdp')">GDP growth</div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <!-- Policy target block end -->

            <!-- Leading indicators block begin -->
            <div class="row">
              <div class="col-lg-6 col-12 mx-auto">
                <div class="block">
                  <div class="row-title">
                    Leading indicators
                  </div>
                  <div class="container-fluid">
                    <div class="row">
                      <div class="col-12">
                        <div class="btn btn-danger" id="us-pmi" style="width:100%" onclick="openIndicator('us-pmi')">Business Sentiment - ISM Manufacturing</div>
                        <div class="btn btn-danger" id="us-nmi" style="width:100%" onclick="openIndicator('us-nmi')">Business Sentiment - NMI Services</div>
                        <div class="btn btn-danger" id="us-umcsi" style="width:100%" onclick="openIndicator('us-umcsi')">Consumer Sentiment - UMCSI</div>
                        <div class="btn btn-danger" id="us-bp" style="width:100%" onclick="openIndicator('us-bp')">Building Permits</div>
                        <div class="btn btn-danger" id="us-m2" style="width:100%" onclick="openIndicator('us-m2')">Money supply - M2</div>
                        <div class="btn btn-danger" id="us-10ybond" style="width:100%" onclick="openIndicator('us-10ybond')">US 10 Year Treasury Benchmark</div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <!-- Leading indicators block end -->

            <!-- Coincident indicators block begin -->
            <div class="row">
              <div class="col-lg-6 col-12">
                <div class="block">
                  <div class="row-title">
                    Coincident indicators
                  </div>
                  <div class="container-fluid">
                    <div class="row">
                      <div class="col-12">
                        <div class="btn btn-warning" id="us-cpi" style="width:100%" onclick="openIndicator('us-cpi')">Inflation - Consumer Price Index</div>
                        <div class="btn btn-warning" id="us-cpicore" style="width:100%" onclick="openIndicator('us-cpicore')">Inflation - Consumer Price Index Core</div>
                        <div class="btn btn-warning" id="us-ppi" style="width:100%" onclick="openIndicator('us-ppi')">Inflation - Producer Price Index</div>
                        <div class="btn btn-warning" id="us-ppicore" style="width:100%" onclick="openIndicator('us-ppicore')">Inflation - Producer Price Index Core</div>
                        <div class="btn btn-warning" id="us-nfp" style="width:100%" onclick="openIndicator('us-nfp')">Employment - Nonfarm Payroll</div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>

              <div class="col-lg-6 col-12">
                <div class="block">
                  <div class="row-title">
                    Authorities' reactions
                  </div>
                  <div class="container-fluid">
                    <div class="row">
                      <div class="col-12">
                        <div class="btn btn-warning" id="us-govdebt" style="width:100%" onclick="openIndicator('us-govdebt')">Government - Government Debt to GDP</div>
                        <div class="btn btn-warning" id="us-govsd" style="width:100%" onclick="openIndicator('us-govsd')">Government - Government Surplus(or Deficit) to GDP</div>
                        <div class="btn btn-warning" id="us-cbbs" style="width:100%" onclick="openIndicator('us-cbbs')">Central Bank - Balance Sheet to GDP</div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <!-- Coincident indicators block end -->

            <!-- Lagging indicators block begin -->
            <div class="row">
              <div class="col-lg-6 col-12 mx-auto">
                <div class="block">
                  <div class="row-title">
                    Lagging indicators
                  </div>
                  <div class="container-fluid">
                    <div class="row">
                      <div class="col-12">
                        <div class="btn btn-secondary" id="us-ir" style="width:100%" onclick="openIndicator('us-ir')">Interest Rate - Federal Reserve Benchmark Rate</div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <!-- Lagging indicators block end -->

        </div>

      </section>

      <!-- Indicator window begin -->
        <div class="overlay overlay-dark" id="indicatorWindowWrapper" style="display:none;">
          <div>
            <div class="modal-content welcome-content client-form-content" style="width:90%;height:90vh;margin:15px auto;">
              <div class="modal-header d-flex justify-content-center">
                <h3 class="heading" id="indicatorWindowHeading"></h3>
              </div>
              <div class="modal-body" style="max-height:100% !important;">
                <div id="indicatorWindowTabs">
                  <div class="btn btn-primary" id="indicatorWindowTab-0" onclick="indicatorTab(0)">Biểu đồ</div>
                  <div class="btn btn-secondary" id="indicatorWindowTab-1" onclick="indicatorTab(1)">Thống kê</div>
                  <div class="btn btn-secondary" id="indicatorWindowTab-2" onclick="indicatorTab(2)">Dữ liệu</div>
                </div>
                <div id="indicatorTabContent">
                  <div id="indicatorTabContent-0" style="display:block;">
                    <!-- Tab 0 begin -->
                    <div class="container-fluid mt-1">
                      <div class="row">
                        <div class="col-12">
                          <div class="block">
                            <div id="indicatorChart">

                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                    <!-- Tab 0 end -->
                  </div>
                  <div id="indicatorTabContent-1" style="display:none;">
                    <!-- Tab 1 begin -->
                    <div class="container-fluid mt-1">
                      <div class="row">
                        <div class="col-12">
                          <div class="block">
                            <div id="indicatorStats">
                              <table id="indicatorStatTable" style="width:100%">
                                <tr>
                                  <td>id</td>
                                  <td>feature</td>
                                  <td>value</td>
                                </tr>
                                <tr>
                                  <td>id</td>
                                  <td>feature</td>
                                  <td>value</td>
                                </tr>
                                <tr>
                                  <td>id</td>
                                  <td>feature</td>
                                  <td>value</td>
                                </tr>
                                <tr>
                                  <td>id</td>
                                  <td>feature</td>
                                  <td>value</td>
                                </tr>
                              </table>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                    <!-- Tab 1 end -->
                  </div>
                  <div id="indicatorTabContent-2" style="display:none;">
                    <!-- Tab 2 begin -->
                    <div class="containter-fluid mt-1">
                      <div class="row">
                        <div class="col-lg-6 col-12">
                          <div class="block">
                            <!-- Data table begin -->
                            <div id="indiDataTable" class='block-content' style="height:400px;overflow:auto;"></div>
                            <!-- Data table end -->
                          </div>
                        </div>
                        <div class="col-lg-6 col-12">
                          <div class="block">
                            <div class="row-title">
                              <div class="btn btn-primary" id="indicatorInputToggle" onclick="indicatorEnableForm('input')">Nhập dữ liệu</div>
                              <div class="btn btn-secondary" id="indicatorEditToggle" onclick="indicatorEnableForm('edit')">Sửa dữ liệu</div>
                            </div>
                            <!-- Data input form begin -->
                            <form action="" id="indicatorInputForm" style="display:block">
                              <div class="container-fluid">
                                <div class="row">
                                  <div class="col-12">
                                    <label>Ngày</label>
                                    <input type="date" id="indicatorInputDate" class="form-control" placeholder="">
                                  </div>
                                  <div class="col-12">
                                    <label>Giá trị</label>
                                    <input type="text" id="indicatorInputValue" class="form-control" placeholder="">
                                  </div>
                                  <div class="col-12 text-center">
                                    <div class="btn btn-success" id="applyInputBtn">Nhập</div>
                                  </div>
                                </div>
                              </div>
                            </form>
                            <!-- Data input form end -->
                            <!-- Data edit form begin -->
                            <form action="" id="indicatorEditForm" style="display:none">
                              <div class="container-fluid">
                                <div class="row">
                                  <div class="col-12">
                                    <label>Ngày</label>
                                    <input type="date" id="indicatorEditDate" class="form-control" placeholder="">
                                  </div>
                                  <div class="col-12">
                                    <label>Giá trị</label>
                                    <input type="text" id="indicatorEditValue" class="form-control" placeholder="">
                                  </div>
                                  <div class="col-12 text-center">
                                    <div class="btn btn-warning" id="applyEditBtn">Sửa</div>
                                  </div>
                                </div>
                              </div>
                            </form>
                            <!-- Data edit form end -->
                          </div>
                        </div>
                      </div>
                    </div>
                    <!-- Tab 2 end -->
                  </div>
                </div>
              </div>
              <div class="modal-footer d-flex justify-content-center">
                <span id="indicatorWindowClose" class="btn btn-danger" onclick="closeIndicatorWindow()">Đóng</span>
              </div>
            </div>
          </div>
        </div>
      <!-- Indicator window end -->

    </div>
  </div>
</body>
<%- include ('../tail.ejs') %>
<script src="/js/favico.min.js"></script>
<script src="/js/custom-script.js"></script>
<script src="https://canvasjs.com/assets/script/canvasjs.min.js"></script>
<script>
  function openIndicator(indicatorCode) {
    console.log(indicatorCode);
    let indicatorWindow = document.getElementById("indicatorWindowWrapper");
    try {
      updateIndiWindowTitle(indicatorCode.toUpperCase());
      indicatorWindow.style.display = "block";
      // Reset indicator window
      resetIndiWindow();
      // Fetch data
      fetch("/fx/indicator", {
        method: "POST",
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify({
          indicatorCode: indicatorCode
        })
      }).then(res => res.json())
      .then(res => {
        console.log(res);
        // Update indicator window
        updateIndiWindowData(res.indiData);
      })
      .catch(err => {
        console.log(err);
      });
    } catch(err) {
      console.log(err);
    }
  }

  function resetIndiWindow() {
    try {
      document.getElementById('indiDataTable').innerHTML = 'loading...';
    } catch(err) {
      console.log(err);
    }
  }

  function updateIndiWindowTitle(indiTitle) {
    try {
      document.getElementById('indicatorWindowHeading').innerHTML = indiTitle;
    } catch(err) {
      console.log(err);
    }
  }

  function updateIndiWindowData(indiData) {
    let indiDataContent = 'Dữ liệu đang cập nhật';
    if (indiData != undefined) {
      indiDataContent = '<table class="text-center" style="width:100%"><tr><th>Ngày tham chiếu</th><th>Số liệu</th>';
      for (var i=1; i<indiData.length; i++) {
        indiDataContent += '<tr><td>' + indiData[i][0] + '</td><td>' + indiData[i][1] + '</td></tr>';
      }
      indiDataContent += '</table>';
    }
    try {
      document.getElementById('indiDataTable').innerHTML = indiDataContent;
    } catch(err) {
      console.log(err);
    }
  }

  function closeIndicatorWindow() {
    let indicatorWindow = document.getElementById("indicatorWindowWrapper");
    try {
      indicatorWindow.style.display = "none";
    } catch(err) {
      console.log(err);
    }
  }

  function indicatorTab(id) {
    let tabs = document.getElementById("indicatorWindowTabs");
    let tabContent = document.getElementById("indicatorTabContent");
    if(tabs != null && tabContent != null) {
      //console.log(tabs.children.length);
      for(var i=0;i<tabs.children.length;i++) {
        tabs.children[i].classList.remove("btn-primary");
        tabs.children[i].classList.add("btn-secondary");
      }
      for(var i=0;i<tabContent.children.length;i++) {
        tabContent.children[i].style.display = "none";
      }
      tabs.children[id].classList.remove("btn-secondary");
      tabs.children[id].classList.add("btn-primary");
      tabContent.children[id].style.display = "block";
    }
  }

  //------------------------
  // Data form toggle
  //------------------------
  function indicatorEnableForm(formName) {
    let indicatorInputToggle = document.getElementById("indicatorInputToggle");
    let indicatorEditToggle = document.getElementById("indicatorEditToggle");
    let inputForm = document.getElementById("indicatorInputForm");
    let editForm = document.getElementById("indicatorEditForm");
    if(formName=="input") {
      try {
        inputForm.style.display = "block";
        editForm.style.display = "none";
        indicatorInputToggle.classList.add("btn-primary");
        indicatorEditToggle.classList.remove("btn-primary");
        indicatorInputToggle.classList.remove("btn-secondary");
        indicatorEditToggle.classList.add("btn-secondary");
        editForm.reset();
      } catch(err) {
        console.log(err);
      }
    }
    if(formName=="edit") {
      try {
        inputForm.style.display = "none";
        editForm.style.display = "block";
        indicatorInputToggle.classList.remove("btn-primary");
        indicatorEditToggle.classList.add("btn-primary");
        indicatorInputToggle.classList.add("btn-secondary");
        indicatorEditToggle.classList.remove("btn-secondary");
        inputForm.reset();
      } catch(err) {
        console.log(err);
      }
    }
  }
  //------------------------
</script>

</html>
